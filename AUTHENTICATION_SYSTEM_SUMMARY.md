# ‡∏£‡∏∞‡∏ö‡∏ö Authentication Summary

## üîê ‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏° Role

### 1. üè™ RESTAURANT_OWNER (‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô)
- **‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡πà‡∏≤‡∏ô**: `/auth/signin` (NextAuth Credentials)
- **‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à**: redirect ‡πÑ‡∏õ `/restaurant`
- **‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå**:
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LINE LIFF
  - ‡∏î‡∏π‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
  - ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û

### 2. üëë ADMIN (‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö)
- **‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡πà‡∏≤‡∏ô**: `/auth/signin` (NextAuth Credentials)
- **‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à**: redirect ‡πÑ‡∏õ `/admin`
- **‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå**:
  - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  - ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö

### 3. üë§ CUSTOMER (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)
- **‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡πà‡∏≤‡∏ô**: `/menu/[restaurantId]` (LINE LIFF Login)
- **‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à**: ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏¥‡∏°
- **‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå**:
  - ‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  - ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  - ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á

---

## üöÄ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

### Authentication Flow ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RESTAURANT_OWNER & ADMIN

```mermaid
graph TD
    A[‡πÄ‡∏Ç‡πâ‡∏≤ /auth/signin] --> B[‡∏Å‡∏£‡∏≠‡∏Å email/password]
    B --> C[NextAuth Credentials Login]
    C --> D{Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à?}
    D -->|Yes| E{‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Role}
    D -->|No| F[‡πÅ‡∏™‡∏î‡∏á Error]
    E -->|RESTAURANT_OWNER| G[Redirect ‡πÑ‡∏õ /restaurant]
    E -->|ADMIN| H[Redirect ‡πÑ‡∏õ /admin]
    E -->|USER| I[Redirect ‡πÑ‡∏õ /auth/role-selection]
```

### Authentication Flow ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CUSTOMER

```mermaid
graph TD
    A[‡πÄ‡∏Ç‡πâ‡∏≤ /menu/restaurantId] --> B{‡∏°‡∏µ LIFF flag?}
    B -->|Yes| C[‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LINE Login]
    B -->|No| D[‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏Å‡∏ï‡∏¥]
    C --> E{Login LINE ‡πÅ‡∏•‡πâ‡∏ß?}
    E -->|No| F[‡πÄ‡∏£‡∏¥‡πà‡∏° LINE Login]
    E -->|Yes| G{‡∏°‡∏µ NextAuth Session?}
    G -->|No| H[‡∏™‡∏£‡πâ‡∏≤‡∏á NextAuth Session]
    G -->|Yes| I[‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π]
    F --> J[LINE OAuth]
    J --> H
    H --> I
```

---

## üìÅ ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞ Component ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

### NextAuth Configuration
- `src/app/api/auth/[...nextauth]/route.ts` - ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ NextAuth
- `src/app/auth/signin/page.tsx` - ‡∏´‡∏ô‡πâ‡∏≤ login ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RESTAURANT_OWNER & ADMIN

### LIFF Configuration  
- `src/components/LiffHandler.tsx` - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ LINE LIFF login
- `src/app/menu/[restaurantId]/page.tsx` - ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö LIFF
- `src/app/liff/page.tsx` - ‡∏´‡∏ô‡πâ‡∏≤ landing ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LIFF

### API Routes
- `src/app/api/restaurant/default/route.ts` - ‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô default
- `src/app/api/restaurant/[restaurantId]/liff/route.ts` - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ LIFF ID
- `src/app/api/liff/redirect/route.ts` - redirect LIFF ‡πÑ‡∏õ‡πÄ‡∏°‡∏ô‡∏π

### Middleware
- `src/middleware.ts` - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö authentication ‡πÅ‡∏•‡∏∞ routing

---

## üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

### Environment Variables
```env
# NextAuth
NEXTAUTH_SECRET=your_secret_here
NEXTAUTH_URL=http://localhost:3000

# LINE Login
LINE_CLIENT_ID=your_line_client_id
LINE_CLIENT_SECRET=your_line_client_secret

# LINE LIFF
NEXT_PUBLIC_LIFF_ID=your_liff_id_here

# Database
DATABASE_URL=your_database_url
```

### LINE LIFF Setup
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á LINE Login Channel
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á LIFF App
3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Endpoint URL: `https://yourdomain.com/liff`
4. ‡πÄ‡∏û‡∏¥‡πà‡∏° LIFF ID ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡πà‡∏≤‡∏ô `/restaurant/liff-setup`

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö RESTAURANT_OWNER Login
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `http://localhost:3000/auth/signin`
2. Login ‡∏î‡πâ‡∏ß‡∏¢ `ball_t1@hotmail.com` / `123456`
3. ‡∏Ñ‡∏ß‡∏£ redirect ‡πÑ‡∏õ `/restaurant`

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö CUSTOMER Login (LIFF)
1. ‡πÄ‡∏õ‡∏¥‡∏î LINE LIFF URL: `https://liff.line.me/{LIFF_ID}?restaurant={RESTAURANT_ID}`
2. ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏õ‡∏ó‡∏µ‡πà `http://localhost:3000/menu/{RESTAURANT_ID}?liff=true`
3. ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LINE login process
4. ‡∏´‡∏•‡∏±‡∏á login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Navigation
- ‡∏´‡∏ô‡πâ‡∏≤ `/restaurant/*` - ‡∏ï‡πâ‡∏≠‡∏á login ‡πÄ‡∏õ‡πá‡∏ô RESTAURANT_OWNER
- ‡∏´‡∏ô‡πâ‡∏≤ `/admin/*` - ‡∏ï‡πâ‡∏≠‡∏á login ‡πÄ‡∏õ‡πá‡∏ô ADMIN  
- ‡∏´‡∏ô‡πâ‡∏≤ `/menu/*` - ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà login ‡∏´‡∏£‡∏∑‡∏≠ login ‡∏î‡πâ‡∏ß‡∏¢ LINE

---

## üö® ‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

1. **RESTAURANT_OWNER & ADMIN** ‡πÉ‡∏ä‡πâ NextAuth Credentials ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
2. **CUSTOMER** ‡πÉ‡∏ä‡πâ LINE LIFF ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π)
3. ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏π‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà login ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á login ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
4. ‡∏Å‡∏≤‡∏£ redirect ‡∏´‡∏•‡∏±‡∏á login ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö role ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
5. LIFF ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ `/menu/*` ‡πÅ‡∏•‡∏∞ `/cart/*` 